
   <head>
      <link rel="stylesheet" href="./css/az-presentation.css">
      <link rel="stylesheet" href="./css/az-animation.css">
   </head>
   <body>
<script>
   (function() {
      var importDoc = document._currentScript.ownerDocument; // importee
      var allSlide = [];
      var currentSlide = 1;
      var hit = false
         hitTimeOut = null;
      var timeOutBefore = null
         , timeOutNow = null;

      function triggerAnimation (obj){
         if (obj.hasAttribute('fadein')) {
            obj.classList.toggle('animation-fade');
         } else if (obj.hasAttribute('slide')) {
            obj.classList.toggle('animation-fade');
         }
      }

      var setSlide = function(slideNow, slideBefore){
         var zindexNow = "2"
            , zindexBefore = "1";

         if (slideBefore) {
            allSlide[slideBefore-1].style.zIndex = zindexBefore;
            setTimeout(function () {
               allSlide[slideBefore-1].style.display = "none";
               triggerAnimation(allSlide[slideBefore-1]);
            }, 1000);
         }

         allSlide[slideNow-1].style.zIndex = zindexNow;
         allSlide[slideNow-1].style.display = "block";

         triggerAnimation(allSlide[slideNow-1]);

         currentSlide = slideNow;

         location.hash = slideNow;
      }

      if (window.location.hash.substr(1)){
         currentSlide = parseInt(window.location.hash.substr(1));
      }

      // az-button js
      var azpresslide = Object.create(HTMLElement.prototype);

      azpresslide.createdCallback = function () {
         var title = this.querySelector("slide-title");
         var header = this.querySelector("header");
         var mainBackColor = this.getAttribute("color") || "white";
         var contentColor = this.getAttribute("contentColor") || "black";
         allSlide.push(this);

         this.style.backgroundColor = mainBackColor;
         this.style.color = contentColor;

         if (allSlide.length === currentSlide) {
            setSlide(currentSlide);
         } else {
            // this.style.opacity = 0;
            this.style.display = "none";
         }

         if (title) {
            var titleColor = title.getAttribute("color") || "black";
            title.style.color = titleColor;
         }

         if (header) {
            var headerColor = header.getAttribute("color") || "black";
            header.style.color = headerColor;
         }

      };

      document.registerElement('az-pres-slide', {prototype: azpresslide});
      // end of js az-button

      var azcoding = Object.create(HTMLElement.prototype);

      azcoding.createdCallback = function () {
         var content = this.innerHTML;

         var code = {};

         code.def = {
            option: ["var", "function", "require"] ,
            open: "<span class='def-syntax'>" ,
            close: "</span>"
         }

         code.string = {
            option: ["\'.*?\'" , "\".*?\""] ,
            open: "<span class='string'>" ,
            close: "</span>"
         }

         function joinAll(obj){
            var arr = {};
            var a = 1;
            for (var key in code) {

               if (code.hasOwnProperty(key)) {
                  var codeObj = code[key];

                  for (var i = 0; i < codeObj.option.length; i++) {

                     var option = codeObj.option[i];

                     arr[a] = { name: option, open: codeObj.open , close: codeObj.close };

                     a++;
                  }
               }
            }

            return arr;
         }

         var mapObj = joinAll(code);

         function reConvert (obj){
            var arr = [];
            Object.keys(obj).forEach(function (key) {
               arr.push("("+obj[key].name+")");
            });

            return arr.join("|");
         }

         var re = new RegExp(reConvert(mapObj),"gi");

         content = content.replace(re, function(matched){
            var pj = Object.keys(mapObj).length;

            for (var i = 1; i <= pj; i++) {
               if (arguments[i]) {
                  return mapObj[i].open + matched + mapObj[i].close;
               }
            }
         });


         this.innerHTML = content;
      }

      document.registerElement('az-coding', {
         prototype: azcoding ,
         extends: "div"
      });

      document.body.addEventListener("keydown" , function(e){
         // console.log(e.keyCode);

         if (!hit) {
            switch (e.keyCode) {
               case 39:
                  if (currentSlide + 1 <= allSlide.length) {
                     var slideBefore = currentSlide;
                     var slideNow = currentSlide + 1;

                     setSlide(slideNow, slideBefore);
                  }
                  break;
               case 37:
                  if (currentSlide-1 >= 1) {
                     var slideBefore = currentSlide;
                     var slideNow = currentSlide - 1;

                     setSlide(slideNow, slideBefore);
                  }
                  break;
            }
            hit = true;
         }

         if (!hitTimeOut) {
            hitTimeOut = setTimeout(function () {
               hit = false;
               hitTimeOut = false;
            }, 1200);
         }
      });
   })();
</script>
