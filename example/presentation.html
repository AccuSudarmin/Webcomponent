<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <script src="../lib/azcomponent/webcomponentsjs/webcomponents.js"></script>
      <link rel="import" href="../lib/azcomponent/az-ui.html">
      <link rel="import" href="../lib/azcomponent/az-presentation.html">
      <title>WebRTC - Azrul Sudarmin</title>
      <style>
         html, body {
            margin: 0px;
            padding: 0px;
            width: 100%;
            height: 100%;
            background-color: black;
            font-family: Helvetica, Arial, sans-serif;
         }

         body {
            display: flex;
            flex-direction: column;
            justify-content: center;
         }

      </style>
   </head>

   <body>
      <az-presentation>
         <az-pres-slide color="#EC312E" contentColor="white" fade>
            <slide-title color="white">
               WebRTC
            </slide-title>
         </az-pres-slide>

         <az-pres-slide color="#0096BB" contentColor="white" swipe>
            <header color="white">
               HTML5
            </header>
            <slide-content>
               <center>
                  <img src="./img/html5.png" alt="HTML5" width="900px" />
               </center>
            </slide-content>
         </az-pres-slide>

         <az-pres-slide color="#7870B3" contentColor="white" swipe>
            <header>
               Why WebRTC?
            </header>
            <slide-content>
               <ul type="square">
                  <li> No need to install Plugins! </li>
                  <li> Secure Channel </li>
                  <li> Bandwidth friendly </li>
               </ul>
            </slide-content>
         </az-pres-slide>

         <az-pres-slide color="#EC312E" contentColor="white" swipe>
            <header>
               WebRTC Accross Platform
            </header>
            <slide-content>
               <ul type="square">
                  <li> Chrome </li>
                  <li> Chrome for Android </li>
                  <li> Firefox </li>
                  <li> Opera </li>
                  <li> Native java and Objective-C bindings </li>
               </ul>
            </slide-content>
         </az-pres-slide>

         <az-pres-slide color="#EC312E" contentColor="white" swipe>
            <header>
               Three main Javascript API for WebRTC
            </header>
            <slide-content>
               <ul type="square">
                  <li> MediaStream (aka getUserMedia) </li>
               </ul>
            </slide-content>
         </az-pres-slide>

         <az-pres-slide color="#EC312E" contentColor="white" fade>
            <header>
               Three main Javascript API for WebRTC
            </header>
            <slide-content>
               <ul type="square">
                  <li> MediaStream (aka getUserMedia) </li>
                  <li> RTCPeerConnection </li>
               </ul>
            </slide-content>
         </az-pres-slide>

         <az-pres-slide color="#EC312E" contentColor="white" fade>
            <header>
               Three main Javascript API for WebRTC
            </header>
            <slide-content>
               <ul type="square">
                  <li> MediaStream (aka getUserMedia) </li>
                  <li> RTCPeerConnection </li>
                  <li> RTCDataChannel </li>
               </ul>
            </slide-content>
         </az-pres-slide>

         <az-pres-slide color="#252525" contentColor="white" roll>
            <slide-title color="white">
               MediaStream aka getUserMedia
            </slide-title>
         </az-pres-slide>

         <az-pres-slide contentColor="black" swipe>
            <header>
               getUserMedia
            </header>
            <slide-content>
               <center>
                  <p> Represents a stream of audio and/or video </p>
                  <img src="./img/getUserMedia.png" alt="getUserMedia" width="900px"/>
               </center>
            </slide-content>
         </az-pres-slide>

         <az-pres-slide color="#7870B3" contentColor="black" swipe>
            <header>
               Access Video and Audio
            </header>
            <slide-content>
               <div is="az-coding" class="coding">
                  navigator.getUserMedia(constraints, successCallback, errorCallback);
               </div>
               <div style="
                  display: table;
                  margin: 20px auto;
                  background-color: #FFF;
                  overflow: hidden;
                  padding: 10px;
                  width: 420px;
                  box-sizing: border-box;
               ">
                  <video id="getusermedia" width="400px" color="black" autoplay></video> <br>
                  <center>
                     <az-button id="call">Call</az-button>
                     <az-button id="stop">Stop</az-button>
                  </center>
               </div>
            </slide-content>
         </az-pres-slide>

         <az-pres-slide contentColor="black" swipe>
            <header>
               Access Video and Audio
            </header>
            <slide-content>
               <div is="az-coding" class="coding">
                  <header> javascript </header>
                  &lt;video autoplay&gt;&lt;/video&gt; <br>
                  &lt;script&gt; <br>
                  &nbsp;&nbsp;navigator.getUserMedia = (
                  navigator.getUserMedia || <br>
                  &nbsp;&nbsp;&nbsp;&nbsp;navigator.webkitGetUserMedia || <br>
                  &nbsp;&nbsp;&nbsp;&nbsp;navigator.mozGetUserMedia || <br>
                  &nbsp;&nbsp;&nbsp;&nbsp;navigator.msGetUserMedia <br>
                  &nbsp;&nbsp;); <br>

                  &nbsp;&nbsp;var errorCallback = function(e) { <br>
                  &nbsp;&nbsp;&nbsp;&nbsp;console.log('Reeeejected!', e); <br>
                  &nbsp;&nbsp;}; <br>

                  &nbsp;&nbsp;navigator.getUserMedia( {video: true, audio: true} , <br>
                  &nbsp;&nbsp;function(localMediaStream) { <br>
                  &nbsp;&nbsp;&nbsp;&nbsp;var video = document.querySelector('video'); <br>
                  &nbsp;&nbsp;&nbsp;&nbsp;video.src = window.URL.createObjectURL(localMediaStream); <br>
                  &nbsp;&nbsp;&nbsp;&nbsp;video.onloadedmetadata = function(e) { <br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//do some stuff <br>
                  &nbsp;&nbsp;&nbsp;&nbsp;}; <br>
                  &nbsp;&nbsp;}, errorCallback); <br>
                  &lt;/script&gt;
               </div>
            </slide-content>
         </az-pres-slide>

         <az-pres-slide  color="#EC312E" contentColor="white" swipe>
            <header color="white">
               3 Parameters
            </header>
            <slide-content>
               <div is="az-coding" class="coding">
                  navigator.getUserMedia(constraints, successCallback, errorCallback);
               </div>

               <ul type="square">
                  <li>Constraints
                     <ul>
                        <li>an object having either one or both the properties audio and video.</li>
                        <li>To get both video and audio you would use: { video: true, audio: true }</li>
                     </ul>
                  </li>
                  <li>successCallback
                     <ul>
                        <li>A function that will be called if the media stream is successfully loaded.</li>
                        <li>The function will be passed a LocalMediaStreamobject.</li>
                     </ul>
                  </li>
                  <li>errorCallback (optional)
                     <ul>
                        <li>A function that will be called if the media stream cannot be loaded.</li>
                     </ul>
                  </li>
               </ul>
            </slide-content>
         </az-pres-slide>

         <az-pres-slide color="#252525" contentColor="white" roll>
            <slide-title color="white">
               RTCPeerConnection
            </slide-title>
         </az-pres-slide>

         <az-pres-slide color="#7870B3" contentColor="black" swipe>
            <header color="white">
               Communicate Media Stream
            </header>
            <slide-content>
               <center>
                  <img src="./img/peercon.png" alt="Communicate Media Stream" width="900px"/>
               </center>
            </slide-content>
         </az-pres-slide>

         <az-pres-slide  color="#EC312E" contentColor="white" swipe>
            <header color="white">
               RTCPeerConnection does a lot
            </header>
            <slide-content>
               <ul type="square">
                  <li>Signal Processing</li>
                  <li>Codec handling</li>
                  <li>Peer to peer communication</li>
                  <li>Security</li>
                  <li>Bandwidth Management</li>
               </ul>
            </slide-content>
         </az-pres-slide>

         <az-pres-slide contentColor="black" swipe>
            <header color="black">
               WebRTC Architecture
            </header>
            <slide-content>
               <center>
                  <img src="./img/rtcarchitecture.png" alt="WebRTC Architecture" width="600px"/>
               </center>
            </slide-content>
         </az-pres-slide>

         <az-pres-slide contentColor="black" swipe>
            <header color="black">
               RTCPeerConnection Sample
            </header>
            <slide-content>
               <div is="az-coding" class="coding">
                  <header> javascript </header>
                  pc = new RTCPeerConnection (null); <br>
                  pc.onaddstream = gotRemoteStream; <br>
                  pc.addStream(localStream); <br>
                  pc.createOffer(gotOffer); <br> <br>

                  function  gotOffer(desc) { <br>
                  &nbsp;&nbsp;pc.setLocalDescription(desc); <br>
                  &nbsp;&nbsp;sendOffer(desc); <br>
                  } <br><br>

                  function gotAnswer(desc) { <br>
                  &nbsp;&nbsp;pc.setRemoteDescription(desc); <br>
                  } <br> <br>

                  function gotRemoteStream(e) { <br>
                  &nbsp;&nbsp;attachMediaStream(remoteVideo, e.stream); <br>
                  } <br>
               </div>
            </slide-content>
         </az-pres-slide>

         <az-pres-slide color="#252525" contentColor="white" roll>
            <slide-title color="white">
               RTCDataChannel
            </slide-title>
         </az-pres-slide>

         <az-pres-slide contentColor="black" swipe>
            <header color="black">
               RTCDataChannel
            </header>
            <slide-content>
               <ul type="square">
                  <li>Same API as WebSockets</li>
                  <li>Ultra-low latency</li>
                  <li>Unreliable or reliable</li>
                  <li>Secure</li>
               </ul>
            </slide-content>
         </az-pres-slide>

         <az-pres-slide contentColor="black" swipe>
            <header color="black">
               RTCDataChannel Sample
            </header>
            <slide-content>
               <div is="az-coding" class="coding">
                  <header> javascript </header>
                  var pc = new webkitRTCPeerConnection(servers, { <br>
                  	&nbsp;&nbsp;optional: [{ RtpDataChannels : true}] <br>
                  }); <br> <br>

                  pc.ondatachannel = function(event) { <br>
                  	&nbsp;&nbsp;receiveChannel = event.channel; <br>
                  	&nbsp;&nbsp;receiveChannel.onmessage = function(event){ <br>
                  		&nbsp;&nbsp;&nbsp;&nbsp;document.querySelector( "div#receive" ).innerHTML = event.data; <br>
                  	&nbsp;&nbsp;}; <br>
                  }; <br> <br>

                  sendChannel = pc.createDataChannel( "sendDataChannel" , {reliable: false}); <br> <br>

                  document.querySelector( "button#send" ).onclick = function (){ <br>
                  	&nbsp;&nbsp;var data = document.querySelector( "textarea#send" ).value; <br>
                  	&nbsp;&nbsp;sendChannel.send(data); <br>
                  };

               </div>
            </slide-content>
         </az-pres-slide>

         <az-pres-slide color="#252525" contentColor="white" roll>
            <slide-title color="white">
               Signalling
            </slide-title>
         </az-pres-slide>

         <az-pres-slide contentColor="black" swipe>
            <header color="black">
               Signalling
            </header>
            <slide-content>
               <ul type="square">
                  <li>Session control, network and media informatiion.</li>
                  <li>It’s peer to peer but still need server to make sure the both side can agree to conduct the session</li>
                  <li>WebRTC doesn’t provide this</li>
               </ul>
            </slide-content>
         </az-pres-slide>

         <az-pres-slide contentColor="black" swipe>
            <header color="black">
               Signalling Diagram
            </header>
            <slide-content>
               <center>
                  <p><img src="./img/signalling.png" alt="Signalling" width="700px"/></p>
               </center>
            </slide-content>
         </az-pres-slide>

      </az-presentation>

      <script type="text/javascript">
         navigator.getUserMedia = (
            navigator.getUserMedia ||
            navigator.webkitGetUserMedia ||
            navigator.mozGetUserMedia ||
            navigator.msGetUserMedia
         );

         var localMediaStream = null;

         var errorCallback = function(e) {
            console.log('Reeeejected!', e);
         };

         function call(){
            navigator.getUserMedia( {video: true, audio: true} ,  function(stream) {
               var video = document.querySelector('video#getusermedia');
               video.src = window.URL.createObjectURL(stream);

               localMediaStream = stream;
               video.onloadedmetadata = function(e) {
                  //do some stuff
               };
            }, errorCallback);
         }

         document.getElementById("call").onclick = function(){
            call();
         }

         document.getElementById("stop").onclick = function(){
            var video = document.querySelector('video');
            video.src = null;
            localMediaStream.stop();
         }
      </script>
   </body>
</html>
